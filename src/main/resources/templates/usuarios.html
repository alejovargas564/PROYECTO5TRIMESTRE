<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Usuarios - SAPIB</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #14B8A6;
            --soft-bg: #F5F7FA;
        }
    </style>
</head>

<body class="bg-[var(--soft-bg)] min-h-screen">

<header class="w-full bg-white shadow-md fixed top-0 left-0 z-20">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">

        <div class="flex items-center space-x-3">
            <img src="/img/sapib.jpg"
                 alt="Logo SAPIB"
                 class="h-12 w-auto rounded-lg shadow">
            <span class="text-2xl font-bold text-[var(--primary)]">SAPIB</span>
            <span class="text-gray-600" th:text="${#authentication.name}"></span>
        </div>
        
        <ul class="flex space-x-6 font-medium text-gray-700">
            <li><a href="/admin-home" class="hover:text-[var(--primary)]">Inicio</a></li>
            <li><a href="/usuarios" class="text-[var(--primary)] font-semibold">Usuarios</a></li>
        </ul>
        
        <form th:action="@{/logout}" method="post">
           <button class="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 shadow transition">
                <i class="bi bi-box-arrow-right mr-1"></i> Cerrar sesión
            </button>
        </form>
    </div>
</header>

<section class="max-w-7xl mx-auto px-6 py-24">

    <h1 class="text-4xl font-extrabold text-[var(--primary)] mb-8 flex items-center">
        <i class="bi bi-people-fill mr-3"></i> Gestión de Usuarios
    </h1>

    <form id="form-busqueda" th:action="@{/usuarios}" method="get"
          class="bg-white p-6 rounded-xl shadow-lg mb-6 flex flex-col md:flex-row items-end gap-4 border border-gray-200">

        <div class="w-full md:w-1/2">
            <label class="font-semibold text-gray-700 block mb-1">Buscar por nombre:</label>
            <input type="text" name="nombre" th:value="${nombre}"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                   placeholder="Escribe un nombre de usuario o fundación...">
        </div>

        <div class="flex gap-3 w-full md:w-auto">
            <button type="submit"
                class="w-full md:w-auto px-5 py-2 bg-[var(--primary)] text-white font-semibold rounded-lg hover:bg-indigo-700 transition shadow-md">
                <i class="bi bi-search"></i> Buscar
            </button>

            <button type="button" onclick="limpiarBusqueda()"
                class="w-full md:w-auto px-5 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 transition">
                <i class="bi bi-x-circle"></i> Limpiar
            </button>
        </div>
    </form>

    <div class="mb-6">
        <a th:href="@{/usuarios/nuevo}"
           class="px-6 py-3 bg-[var(--primary)] text-white rounded-lg shadow-xl hover:bg-indigo-700 transition font-semibold transform hover:scale-[1.01] inline-flex items-center">
            <i class="bi bi-person-plus-fill mr-2"></i> Nuevo Usuario
        </a>
    </div>

    <div class="overflow-x-auto bg-white rounded-xl shadow-lg border border-gray-200">
        <table class="min-w-full divide-y divide-gray-200">
            <thead>
                <tr class="bg-indigo-50 text-xs font-semibold uppercase tracking-wider text-indigo-700 text-left">
                    <th class="p-3">ID</th>
                    <th class="p-3">Usuario</th>
                    <th class="p-3">Correo</th>
                    <th class="p-3">Teléfono</th>
                    <th class="p-3">Tipo Doc</th>
                    <th class="p-3">Documento</th>
                    <th class="p-3">Rol</th>
                    <th class="p-3">Estado</th>
                    <th class="p-3">Fecha Registro</th>
                    <th class="p-3">Acciones</th>
                </tr>
            </thead>

            <tbody class="divide-y divide-gray-100">
                <tr th:each="u : ${usuarios}" class="hover:bg-gray-50 transition duration-150">
                    <td class="p-3 text-sm text-gray-600 font-medium" th:text="${u.id}"></td>
                    <td class="p-3 text-sm font-bold text-gray-900" th:text="${u.userName}"></td>
                    <td class="p-3 text-sm text-gray-600" th:text="${u.correoUsuario}"></td>
                    <td class="p-3 text-sm text-gray-600" th:text="${u.telefonoUsuario}"></td>
                    <td class="p-3 text-sm text-gray-600" th:text="${u.tipoDocumento}"></td>
                    <td class="p-3 text-sm text-gray-600" th:text="${u.numeroDocumento}"></td>

                    <td class="p-3 text-sm">
                        <span th:text="${u.rol}"
                              th:classappend="${u.rol == 'ROLE_ADMIN'} ? 'bg-red-100 text-red-800' : 
                                              ((${u.rol == 'ROLE_FUNDACION'} or ${u.rol == 'FUNDACION'}) ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800')"
                              class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full">
                        </span>
                    </td>

                    <td class="p-3 text-sm">
                        <span th:text="${u.estadoUsuario} ? 'Activo' : 'Inactivo'"
                              th:classappend="${u.estadoUsuario} ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'"
                              class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full">
                        </span>
                    </td>

                    <td class="p-3 text-xs text-gray-500" th:text="${#temporals.format(u.createAt, 'dd-MM-yyyy HH:mm')}"></td>

                    <td class="p-3 flex gap-2 text-sm">
                        <a th:href="@{'/usuarios/editar/' + ${u.id}}"
                           class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition font-medium text-xs">
                           <i class="bi bi-pencil-fill"></i> Editar
                        </a>

                        <a th:href="@{'/usuarios/eliminar/' + ${u.id}}"
                           onclick="return confirm('¿Está seguro de que desea eliminar este usuario? Esta acción es irreversible.')"
                           class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition font-medium text-xs">
                            <i class="bi bi-trash-fill"></i> Eliminar
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="text-right mt-6">
        <a th:href="@{/reporte-usuarios(nombre=${nombre})}"
           class="inline-flex items-center px-6 py-3 bg-[var(--secondary)] text-white font-semibold rounded-lg shadow-xl hover:bg-teal-600 transition transform hover:scale-[1.01]">
            <i class="bi bi-file-earmark-pdf-fill mr-2"></i> Descargar Reporte PDF
        </a>
    </div>

</section>

<script>
function limpiarBusqueda() {
    const input = document.querySelector("input[name='nombre']");
    const form = document.getElementById("form-busqueda");
    
    // 1. Limpia el valor del campo de texto
    input.value = "";
    
    // 2. Envía el formulario (con el parámetro 'nombre' vacío)
    form.submit();
}
</script>

</body>
</html>