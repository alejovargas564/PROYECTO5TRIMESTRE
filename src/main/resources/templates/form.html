<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title> Registrar / Editar Usuario</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root { 
            --primary: #4F46E5; /* Índigo */
            --secondary: #14B8A6; /* Teal */
            --soft-bg: #F5F7FA;
        }
    </style>
</head>

<body class="bg-[var(--soft-bg)] min-h-screen flex justify-center items-center">

<div class="max-w-xl w-full bg-white shadow-2xl rounded-xl p-8 border-t-4 border-[var(--primary)] animate-[fadeIn_.6s_ease-out]">

    <h2 class="text-center text-3xl font-extrabold text-[var(--primary)] mb-6 flex items-center justify-center">
        <i th:classappend="${usuario.id != null} ? 'bi-pencil-square' : 'bi-person-plus-fill'" class="bi mr-3"></i>
        <span th:text="${usuario.id != null} ? 'Actualizar Usuario' : 'Registrar Nuevo Usuario'"></span>
    </h2>

    <form th:action="${#authorization.expression('hasRole(''ADMIN'')') 
                         ? '/usuarios/guardar' 
                         : '/perfil/guardar'}"
          th:object="${usuario}"
          method="post"
          class="space-y-4">

        <input type="hidden" th:field="*{id}"/>

        <div class="border p-4 rounded-lg bg-indigo-50/50">
            <p class="font-bold text-gray-700 mb-3 border-b border-indigo-200 pb-2 flex items-center">
                <i class="bi bi-person-badge-fill mr-2 text-indigo-600"></i> Datos
            </p>
            
            <div>
                <label class="block text-gray-700 mb-1 font-medium">Nombre de usuario:</label>
                <input type="text" th:field="*{userName}"
                       class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--primary)]"
                       required>
            </div>

            <div>
                <label class="block text-gray-700 mb-1 font-medium">Contraseña:</label>
                <input type="password" th:field="*{password}"
                       th:attr="required=${usuario.id == null}"
                       class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--primary)]">
                <small th:if="${usuario.id != null}" class="text-gray-500 text-sm mt-1 block">
                    Dejar en blanco si no desea cambiar la contraseña
                </small>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="col-span-2">
                <label class="block text-gray-700 mb-1 font-medium">Correo electrónico:</label>
                <input type="email" th:field="*{correoUsuario}"
                       class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--primary)]"
                       required>
            </div>

            <div class="col-span-2">
                <label class="block text-gray-700 mb-1 font-medium">Teléfono:</label>
                <input type="text" th:field="*{telefonoUsuario}"
                       class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--primary)]"
                       required>
            </div>
            
            <div>
                <label class="block text-gray-700 mb-1 font-medium">Tipo de Documento:</label>
                <select th:field="*{tipoDocumento}"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-white focus:ring-2 focus:ring-[var(--primary)]"
                        required>
                    <option value="" disabled>Seleccione...</option>
                    <option value="CC">Cédula de Ciudadanía (CC)</option>
                    <option value="PA">Pasaporte (PA)</option>
                    <option value="NIT">NIT</option>
                </select>
            </div>

            <div>
                <label class="block text-gray-700 mb-1 font-medium">Número de Documento:</label>
                <input type="text" th:field="*{numeroDocumento}"
                       class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--primary)]"
                       required>
            </div>
        </div>

        <div class="border p-4 rounded-lg bg-gray-50">
            <p class="font-bold text-gray-700 mb-3 border-b border-gray-200 pb-2 flex items-center">
                <i class="bi bi-sliders mr-2 text-gray-600"></i> Configuración de Cuenta
            </p>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 mb-1 font-medium">Estado:</label>
                    <select th:field="*{estadoUsuario}"
                            class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-white">
                        <option th:value="true">Activo</option>
                        <option th:value="false">Inactivo</option>
                    </select>
                </div>

                <div th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
                    <label class="block text-gray-700 mb-1 font-medium">Rol:</label>
                    <select th:field="*{rol}"
                            class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-white"
                            required>
                        <option value="" disabled>Seleccione...</option>
                        <option value="ROLE_ADMIN">ADMIN</option>
                        <option value="ROLE_FUNDACION">FUNDACIÓN</option>
                        <option value="ROLE_VOLUNTARIO">VOLUNTARIO</option>
                    </select>
                </div>
            </div>
            <input type="hidden" th:if="${!#authorization.expression('hasRole(''ADMIN'')')}" th:field="*{rol}"/>

        </div>

        <button type="submit"
                class="w-full bg-[var(--primary)] text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-lg transform hover:scale-[1.01]">
            <i class="bi bi-save-fill mr-2"></i> Guardar Usuario
        </button>

    </form>

    <div class="text-center mt-6 pt-4 border-t border-gray-200">
        <a th:href="@{/usuarios}" class="text-gray-500 font-semibold hover:text-gray-700 hover:underline flex items-center justify-center">
            <i class="bi bi-arrow-left-circle-fill mr-2"></i> Volver a la Gestión de Usuarios
        </a>
    </div>
</div>

</body>
</html>